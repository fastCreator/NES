/*! grunt 06-11-2015 */
var app=angular.module("app",["ngCookies"]);app.constant("authUrl","/login"),app.constant("userUrl","/users"),app.controller("LayoutController",["$scope","$http","$cookies","$window","$rootScope",function(a,b,c,d,e){a.title="欢迎登陆_NES商城",c.get("emailVerified")&&(d.location.href="/"),a.data={username:"",password:""},a.login=function(){b.post("/login",a.data,{withCredentials:!0}).success(function(b){if(a.remember){var d=new Date;d.setDate(d.getDate()+1)}else var d=null;c.put("userId",b.userId,{expires:d}),c.put("access_token",b.id,{expires:d}),c.put("username",a.data.username,{expires:d}),a.email(d)}).error(function(a){alert("用户名或密码错误")})},a.email=function(a){var e="users/"+c.get("userId");b.get(e,{params:{filter:{fields:{emailVerified:!0}},access_token:c.get("access_token")}}).success(function(b,e,f,g){b.emailVerified?(c.put("emailVerified",!0,{expires:a}),d.location.href="/"):alert("请验证邮箱")}).error(function(){alert("连接loopBack失败")})}}]);