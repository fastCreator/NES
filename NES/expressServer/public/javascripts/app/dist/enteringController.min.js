/*! grunt 06-11-2015 */
var app=angular.module("app",["ngRoute","ngCookies"]);app.controller("LayoutController",["$scope","$rootScope","$http","$cookies","$window",function(a,b,c,d,e){var f=angular.element(".main>.left>a");b.myShop={imgNumb:0},a.title="NES商城后台",b.enteringId=d.get("enteringId"),b.entering_token=d.get("entering_token"),a.login=function(){c.post("/shopuser/login",{username:a.userName,password:a.password}).success(function(c){d.put("enteringId",c.userId),d.put("entering_token",c.id),b.enteringId=c.userId,b.entering_token=c.id,a.getInfo(),f.removeClass("select "),e.location.href="/shopuser#/list"}).error(function(){alert("登录失败")})},a.logout=function(){c.post("/shopuser/logout",{},{params:{access_token:d.get("entering_token")}}).success(function(){d.remove("enteringId"),d.remove("entering_token"),d.remove("myShop_myId"),b.enteringId=null,b.entering_token=null,a.shops=null,a.myShop_myId=!1,b.myShop=null,f.removeClass("select")})},a.getInfo=function(){c.get("/shopuser/"+b.enteringId,{params:{access_token:d.get("entering_token")}}).success(function(b){a.myId=b.myId,a.allowNumb=b.allowNumb,a.numb=a.allowNumb.length;for(var c=new Array,d=0;d<b.myID.length;d++)c.push({myId:b.myID[d]});a.getShop(c)})},a.getShop=function(b){c.get("/goods",{params:{filter:{fields:{myId:!0,id:!0,displayName:!0,price:!0},where:{or:b}}}}).success(function(b){a.shops=b})},b.enteringId&&a.getInfo(),f.bind("click",function(b){f.removeClass("select"),a.reduceMessage="",angular.element(b.target).addClass("select"),angular.element(".message").text("")}),a.goDetailed=function(f){d.put("myShop_myId",f),a.myShop_myId=f,c.get("/goods/findOne",{params:{filter:{where:{myId:f}}}}).success(function(a){b.myShop=a,e.location.href="/shopuser#/revise"}).error(function(){e.location.href="/shopuser#/add"})},a.paramsShow=function(a){angular.element(".none"+a).toggle()},a.addClassify=function(){b.myShop.classify.push(["父属性","子属性"])},a.reduceClassify=function(a){b.myShop.classify.splice(a,1)},a.addClass=function(a){b.myShop.classify[a].push("子属性")},a.submit=function(a){angular.element(".message").text("正在生上传>>>>>"),a?d.put("myShop",b.myShop):d.put("myShop_myId",b.myShop.myId)},a.removeParameter=function(a){b.myShop.parameter.splice(a,2)},a.addParameter=function(a){b.myShop.parameter[a].push("请输入属性名"),b.myShop.parameter[a].push("请输入属性值")},a.removeParameterArray=function(a,c){b.myShop.parameter[a].splice(c,2)},a.pushParameter=function(){b.myShop.parameter.push("请输入属性类别"),b.myShop.parameter.push(["请输入属性名","请输入属性值"])}}]),app.config(["$routeProvider",function(a){a.when("/list",{templateUrl:"/views/app/list",controller:["$scope",function(a){angular.element(".main>.left>a").eq(0).addClass("select"),a.getInfo()}]}).when("/add",{templateUrl:"/views/app/add",controller:["$rootScope",function(a){angular.element(".main>.left>a").removeClass("select"),angular.element(".main>.left>a").eq(2).addClass("select"),a.myShop={myId:"",D3Numb:0,searchText:"",imgNumb:5,displayName:"",introduce:"",price:1,link:[""],classify:[],classifyNumb:["",""],select:"",shopDetails:["",1],parameter:["请添加属性类型",["请添加属性名","请添加属性值"]]}}]}).when("/revise",{templateUrl:"/views/app/revise",controller:["$scope","$cookies",function(a,b){a.goDetailed(b.get("myShop_myId")),angular.element(".main>.left>a").removeClass("select"),angular.element(".main>.left>a").eq(1).addClass("select")}]}).when("/express",{templateUrl:"/views/app/express",controller:["$scope","$http",function(a,b){angular.element(".main>.left>a").removeClass("select"),angular.element(".main>.left>a").eq(4).addClass("select"),b.get("/shopuser/express").success(function(c){a.data=c,a.none=function(a){var b=angular.element(a.target);-1==b.attr("class").search(/row/)&&(b=b.parent()),b.nextAll().toggleClass("none")},a.none1=function(a){var b=angular.element(a.target);-1==b.attr("class").search(/row/)&&(b=b.parent()),b.nextAll().toggleClass("none1")},a.deleteOrder=function(c,d){var e=confirm("是否确认删除！");if(e){for(var f=0;f<a.data[d].shop.length;f++)a.data[d].shop[f].hasPost=!0;b.post("/shopuser/express",{id:a.data[d].id,shop:a.data[d].shop}),a.data.splice(d,1)}a.none(c)},a.deleteShop=function(c,d){var e=confirm("是否确认删除！");e&&(a.data[c].shop[d].hasPost=!0,b.post("/shopuser/express",{id:a.data[c].id,shop:[a.data[c].shop[d]]}),a.data[c].shop.splice(d,1))}})}]}).when("/reduce",{templateUrl:"/views/app/reduce",controller:["$scope","$http",function(a,b){angular.element(".main>.left>a").removeClass("select"),angular.element(".main>.left>a").eq(3).addClass("select"),a.reduceShop=function(){var c=angular.element(".reduceID").val();b.post("/shopuser/deletShop",{ID:c}).success(function(){a.reduceMessage="删除成功"}).error(function(){a.reduceMessage="未找到改ID"})}}]}).otherwise({redirectTo:"/list"})}]),app.directive("imgs",["$rootScope",function(a){return{restrict:"E",template:function(a,b){for(var c="",d=1;d<=b.minNumb;d++)c+="<input type='file' name='_"+d+b.name+"''  accept='.jpg '/>";for(var d=parseInt(b.minNumb)+1;d<=b.maxNumb;d++)c+="<input type='file' name='_"+d+b.name+"' ng-if='"+d+"<="+b.bindNumb+"' accept='.jpg '/>";return c}}}]),$(window).load(function(){$(window).width()<1310&&$(".view").css("width","960px")});