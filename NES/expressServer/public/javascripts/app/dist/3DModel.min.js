/*! grunt 06-11-2015 */
function init(){raycaster=new THREE.Raycaster,renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(WIDTH,HEIGHT),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(VIEW_ANGLE,ASPECT,NEAR,FAR),camera.position.set(0,75,160),cameraControls=new THREE.OrbitControls(camera,renderer.domElement),cameraControls.target.set(0,40,0),cameraControls.maxDistance=400,cameraControls.minDistance=10,cameraControls.update(),container.appendChild(renderer.domElement),container.addEventListener("click",onDocumentMouseClick,!1)}function onDocumentMouseClick(a){a.preventDefault(),mouse.x=a.clientX/window.innerWidth*2-1,mouse.y=2*-(a.clientY/window.innerHeight)+1}function fillScene(){var a=new THREE.SphereGeometry(8,50,50),b=new THREE.MeshLambertMaterial({color:16777215}),c=new THREE.Mesh(a,b);c.position.set(0,100,0),c.name="sphere",scene.add(c);var d=function(a){if(a.lengthComputable){var b=a.loaded/a.total*100;console.log(Math.round(b,2)+"% downloaded")}},e=function(a){};THREE.Loader.Handlers.add(/\.dds$/i,new THREE.DDSLoader);var f=new THREE.OBJMTLLoader;f.load("/images/shops/"+myId+"_obj.obj","/images/shops/"+myId+"_mtl.mtl",function(a){a.position.y=0,scene.add(a)},d,e);var g=new THREE.PlaneBufferGeometry(100.1,100.1);groundMirror=new THREE.Mirror(renderer,camera,{clipBias:.003,textureWidth:WIDTH,textureHeight:HEIGHT,color:7829367});var h=new THREE.Mesh(g,groundMirror.material);h.add(groundMirror),h.rotateX(-Math.PI/2),scene.add(h),verticalMirror=new THREE.Mirror(renderer,camera,{clipBias:.003,textureWidth:WIDTH,textureHeight:HEIGHT,color:8952217});var i=new THREE.Mesh(new THREE.PlaneBufferGeometry(60,60),verticalMirror.material);i.add(verticalMirror),i.position.y=35,i.position.z=-45,scene.add(i),sphereGroup=new THREE.Object3D,scene.add(sphereGroup);var j=new THREE.CylinderGeometry(.1,15*Math.cos(Math.PI/180*30),.1,24,1),k=new THREE.MeshPhongMaterial({color:16777215,emissive:4473924}),l=new THREE.Mesh(j,k);l.position.y=-15*Math.sin(Math.PI/180*30)-.05,l.rotateX(-Math.PI);var j=new THREE.SphereGeometry(15,24,24,Math.PI/2,2*Math.PI,0,Math.PI/180*120),m=new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:16777215}));m.position.y=100,m.rotateX(Math.PI/2),scene.add(m);var n=new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:16777215}));n.position.z=-50,n.position.y=50,scene.add(n);var o=new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:8355839}));o.position.z=50,o.position.y=50,o.rotateY(Math.PI),scene.add(o);var p=new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:65280}));p.position.x=50,p.position.y=50,p.rotateY(-Math.PI/2),scene.add(p);var q=new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:16711680}));q.position.x=-50,q.position.y=50,q.rotateY(Math.PI/2),scene.add(q),mainLight=new THREE.PointLight(13421772,2,250),mainLight.position.y=45,scene.add(mainLight);var r=new THREE.DirectionalLight(16777215);r.position.set(0,50,1),scene.add(r),r=new THREE.DirectionalLight(16777215),r.position.set(0,20,20),scene.add(r);var s=new THREE.PointLight(65280,.25,1e3);s.position.set(550,50,0),scene.add(s);var t=new THREE.PointLight(16711680,.25,1e3);t.position.set(-550,50,0),scene.add(t);var u=new THREE.PointLight(8355839,.25,1e3);u.position.set(0,50,550),scene.add(u)}function render(){groundMirror.renderWithMirror(verticalMirror),verticalMirror.renderWithMirror(groundMirror),raycaster.setFromCamera(mouse,camera);var a=raycaster.intersectObjects(scene.children);a.length>0?INTERSECTED!=a[0].object&&"sphere"==a[0].object.name&&(hasLight?(a[0].object.material.color={r:1,g:1,b:1},mouse.x=null,mouse.y=null,mainLight.intensity=2,hasLight=!1):(a[0].object.material.color={r:0,g:0,b:0},mainLight.intensity=.7,mouse.x=null,mouse.y=null,hasLight=!0)):(INTERSECTED&&INTERSECTED.material.emissive.setHex(INTERSECTED.currentHex),INTERSECTED=null),renderer.render(scene,camera)}function update(){start&&(requestAnimationFrame(update),cameraControls.update(),render())}function stop(){$(window).bind("click",function(a){"CANVAS"!=a.target.tagName&&(start=!1,document.getElementById("canvas").removeChild(renderer.domElement),$(window).unbind("click"))})}function init1(){$("#canvas").css("height",$(window).height()+"px"),$("html,body").animate({scrollTop:$("#canvas").offset().top},800),stop(),init(),fillScene(),update()}var container=document.getElementById("canvas"),WIDTH=container.clientWidth,HEIGHT=container.clientHeight,myId=$(".hiddenmyID").val(),VIEW_ANGLE=45,ASPECT=WIDTH/HEIGHT,NEAR=1,FAR=500,start=!0,hasLight=!0,camera,scene,renderer,raycaster,mouse=new THREE.Vector2,INTERSECTED,cameraControls,mainLight,verticalMirror,groundMirror,sphereGroup,smallSphere;init1();